{% extends 'layout.html'%}
    
{% block title %} Admin Dashboard {% endblock%}

{% block head_styles %} 
    <link rel="stylesheet" href="{{ url_for('static', filename='admin_styles.css') }}">
{% endblock %}
    
{% block content %}
<div class="main-content admin-page">
    <div class="admin-header">
        <h1>Admin Panel üîë</h1>
        <p>Welcome back, Administrator. Manage the Private Ballot session here.</p>
    </div>

    <div class="admin-nav-links">
        <a href="{{ url_for('create_ballots') }}" class="admin-link primary">
            <span class="icon">‚ûï</span> Start New Session
        </a>
        <a href="{{ url_for('admin_logout') }}" class="admin-link secondary">
            <span class="icon">üö™</span> Logout
        </a>
        <a href="{{ url_for('root') }}" class="admin-link tertiary">
            <span class="icon">üè†</span> View Public Site
        </a>
    </div>

    <div class="stats-grid">
        <div class="stat-card total">
            <h2>Total Ballots</h2>
            <p>{{ total_ballots }}</p>
        </div>
        <div class="stat-card available">
            <h2>Available Picks</h2>
            <p>{{ available_ballots }}</p>
        </div>
        <div class="stat-card picked">
            <h2>Picks Made</h2>
            <p>{{ picked_ballots }}</p>
        </div>
    </div>

    {# --- START New Conditional Button --- #}
    {% if available_ballots == 0 and picked_ballots > 0 %}
    <div class="results-unlock">
        <p class="text-2xl font-bold text-red-600 mb-2">Session Complete!</p>
        <a href="{{ url_for('reveal_auth') }}" class="admin-link danger">
            <span class="icon">üîí</span> Reveal Picked Ballot/User Names
        </a>
        <p class="text-sm text-gray-600 mt-2">Requires re-authentication for security and audit purposes.</p>
    </div>
    {% endif %}
    {# --- END New Conditional Button --- #}

    <hr>

    <h2>Ballot Results History</h2>

    {% if ballot_results %}
        <div class="results-table-container">
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Item Name</th>
                        <th>Status</th>
                        <th>Picked By (IP)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ballot in ballot_results %}
                    <tr class="{% if ballot.is_picked %} picked-row {% else %} available-row {% endif %}">
                        <td>{{ loop.index }}</td>
                        <td>{{ ballot.name }}</td>
                        <td>
                            {% if ballot.is_picked %}
                                <span class="status-picked">Picked</span>
                            {% else %}
                                <span class="status-available">Available</span>
                            {% endif %}
                        </td>
                        <td>{{ ballot.picked_by if ballot.picked_by else 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No ballot data found. Please <a href="{{ url_for('create_ballots') }}">start a new session</a>.</p>
    {% endif %}
</div>

<footer class="footer">
    &copy; 2025 PrivateBallot | Admin Dashboard
</footer>
{% endblock %}